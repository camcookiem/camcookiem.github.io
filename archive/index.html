<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Archive Radio</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    #controls button { margin: 5px; padding: 10px; }
    svg { width: 20px; height: 20px; vertical-align: middle; }
    #share-box {
      display: none;
      border: 1px solid #ccc;
      padding: 10px;
      margin-top: 10px;
    }
    #share-link { word-break: break-all; }
  </style>
</head>
<body>
  <h1>Archive Radio</h1>
<p>IN EDIT!<br>Want to use? Look at the URL above and then at the end of the url tipe q= and then enter wautever you want to lisen to.<br>For example the url will look like: https://camcookiem.github.io/music/archive/?q=EXAMPLE THING</p><p>WARNING: Camcookie Has no control of waut the Archive Plays! Use at your owln risk!</p><p>This uses Archive.org API! Go cheack out ware these songs come from at archive.org</p>
<br>
  <div id="now-playing">Nothing playing</div>
  <audio id="player" controls></audio>

  <div id="controls">
    <button id="toggle"><svg><use href="#ic-play"/></svg> Play</button>
    <button id="skip"><svg><use href="#ic-skip"/></svg> Skip</button>
    <button id="replay"><svg><use href="#ic-replay"/></svg> Replay Last</button>
    <button id="share"><svg><use href="#ic-share"/></svg> Share</button>
  </div>

  <!-- Share box -->
  <div id="share-box">
    <div id="share-link"></div>
    <button id="close-share">Close</button>
  </div>

  <!-- SVG icons -->
  <svg xmlns="http://www.w3.org/2000/svg" style="display:none">
    <symbol id="ic-play" viewBox="0 0 24 24"><path fill="currentColor" d="M8 5v14l11-7z"/></symbol>
    <symbol id="ic-pause" viewBox="0 0 24 24"><path fill="currentColor" d="M6 19h4V5H6zm8-14v14h4V5z"/></symbol>
    <symbol id="ic-skip" viewBox="0 0 24 24"><path fill="currentColor" d="M6 7v10l7-5-7-5zm9 0h3v10h-3z"/></symbol>
    <symbol id="ic-replay" viewBox="0 0 24 24"><path fill="currentColor" d="M12 5V2L8 6l4 4V7c3.31 0 6 2.69 6 6a6 6 0 1 1-12 0H4a8 8 0 1 0 16 0c0-4.42-3.58-8-8-8z"/></symbol>
    <symbol id="ic-share" viewBox="0 0 24 24"><path fill="currentColor" d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7a3.2 3.2 0 0 0 0-1.39l7.05-4.11A3 3 0 1 0 17 5a3 3 0 0 0-2.91 2.09L7.05 11.2A3 3 0 1 0 6 19a3 3 0 0 0 2.91-2.09l7.14-4.17c.52.48 1.2.78 1.95.78a3 3 0 1 0 0-6"/></symbol>
  </svg>

  <script>
    const player = document.getElementById('player');
    const nowPlaying = document.getElementById('now-playing');
    const toggleBtn = document.getElementById('toggle');
    const skipBtn = document.getElementById('skip');
    const replayBtn = document.getElementById('replay');
    const shareBtn = document.getElementById('share');
    const shareBox = document.getElementById('share-box');
    const shareLink = document.getElementById('share-link');
    const closeShare = document.getElementById('close-share');

    let queue = [];
    let currentDoc = null;
    let lastDoc = null;
    let page = 1;

    // Get ?q= and ?s= from URL
    const params = new URLSearchParams(location.search);
    const q = params.get('q') || 'music';
    const s = params.get('s');

    async function fetchMore() {
      const url = 'https://archive.org/advancedsearch.php?' + new URLSearchParams({
        q: `(${q}) AND mediatype:(audio)`,
        output: 'json',
        rows: '1',
        page: page++,
        sort: 'downloads desc'
      });
      const res = await fetch(url);
      const data = await res.json();
      const docs = data.response.docs;
      if (docs.length) queue.push(docs[0]);
    }

    async function resolveAudio(identifier) {
      const metaURL = `https://archive.org/metadata/${identifier}`;
      const res = await fetch(metaURL);
      const meta = await res.json();
      const file = meta.files.find(f => /\.(mp3|ogg|wav|flac)$/i.test(f.name));
      return file ? `https://archive.org/download/${identifier}/${file.name}` : '';
    }

    async function playDoc(doc) {
      if (!doc) return;
      lastDoc = currentDoc;
      currentDoc = doc;
      nowPlaying.textContent = doc.title || doc.identifier;
      const src = await resolveAudio(doc.identifier);
      player.src = src;
      player.play();
      updateToggleButton();
      fetchMore(); // always add one more for endless play
    }

    function updateToggleButton() {
      if (player.paused) {
        toggleBtn.innerHTML = '<svg><use href="#ic-play"/></svg> Play';
      } else {
        toggleBtn.innerHTML = '<svg><use href="#ic-pause"/></svg> Pause';
      }
    }

    // Controls
    toggleBtn.addEventListener('click', () => {
      if (!player.src && queue.length) {
        playDoc(queue.shift());
      } else if (player.paused) {
        player.play();
      } else {
        player.pause();
      }
      updateToggleButton();
    });

    skipBtn.addEventListener('click', () => {
      if (queue.length) playDoc(queue.shift());
    });

    replayBtn.addEventListener('click', () => {
      if (lastDoc) playDoc(lastDoc);
    });

    player.addEventListener('play', updateToggleButton);
    player.addEventListener('pause', updateToggleButton);

    // Auto-advance forever
    player.addEventListener('ended', () => {
      if (queue.length) {
        playDoc(queue.shift());
      } else {
        fetchMore().then(() => {
          if (queue.length) playDoc(queue.shift());
        });
      }
    });

    // Share button logic
    shareBtn.addEventListener('click', () => {
      if (!currentDoc) return;
      const base = location.origin + location.pathname;
      const link = `${base}?s=${encodeURIComponent(currentDoc.identifier)}&q=${encodeURIComponent(q)}`;
      shareLink.textContent = link;
      shareBox.style.display = 'block';
    });

    closeShare.addEventListener('click', () => {
      shareLink.textContent = '';
      shareBox.style.display = 'none';
    });

    // Initial seed
    (async function init() {
      await fetchMore();
      if (s) {
        // Play shared song first
        const doc = queue.find(d => d.identifier === s);
        if (doc) {
          await playDoc(doc);
          return;
        }
      }
      if (queue.length) playDoc(queue.shift());
    })();
  </script>
</body>
</html>